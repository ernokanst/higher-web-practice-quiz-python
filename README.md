# Quiz API

REST API для создания и управления интерактивными викторинами (квизами). Платформа позволяет создавать вопросы с вариантами ответов, группировать их по темам и квизам, а также проверять правильность ответов пользователей.

## Описание проекта

Quiz API представляет собой backend-решение для системы викторин, предоставляющее полнофункциональный интерфейс для:
- Создания и управления категориями вопросов
- Создания квизов (наборов вопросов)
- Управления вопросами с вариантами ответов
- Проверки правильности ответов
- Получения случайных вопросов из квиза
- Поиска по названию квиза и тексту вопросов

API построен на основе Django REST Framework и реализует принципы RESTful архитектуры с полным набором CRUD-операций. Проект следует лучшим практикам Django, включая разделение слоев (контроллеры → сервисы → модели), полную типизацию и валидацию данных.
API построен на основе Django REST Framework. CRUD-операции реализованы через `ModelViewSet`, а дополнительные эндпоинты — через `@action`. Валидация выполняется в сериализаторах и валидаторах.

## Функциональность

### Категории
- Создание тематических категорий для вопросов
- Просмотр всех категорий
- Получение, обновление и удаление конкретной категории
- Защита от дублирования названий категорий
- Полнофункциональная админ-панель с поиском и сортировкой

### Квизы
- Создание именованных наборов вопросов
- Добавление описания к квизу
- Получение всех квизов или конкретного квиза по ID
- Поиск квизов по названию
- Получение случайного вопроса из квиза
- Редактирование и удаление квизов

### Вопросы
- Создание вопросов с несколькими вариантами ответа (минимум 2)
- Привязка вопросов к квизу и категории
- Установка уровня сложности (easy, medium, hard)
- Добавление объяснения правильного ответа
- Поиск вопросов по тексту
- Проверка правильности ответа пользователя
- Получение случайного вопроса из квиза

### Валидация
- Обязательные поля проверяются при создании
- Максимальная длина текстовых полей контролируется
- Правильный ответ должен быть одним из предложенных вариантов
- Варианты ответов должны быть массивом минимум из 2 элементов
- Уникальность названий категорий
- Автоматическая нормализация данных (удаление лишних пробелов)

## Технологии

- **Python** 3.12+
- **Django** 5.2.6 - высокоуровневый веб-фреймворк
- **Django REST Framework** 3.16.1 - мощный инструментарий для построения Web API
- **drf-yasg** 1.21.10 - автоматическая генерация OpenAPI/Swagger документации
- **pytest** 8.4.2 - фреймворк для тестирования
- **pytest-django** 4.11.1 - интеграция pytest с Django
- **ruff** 0.13.1 - быстрый линтер и форматтер кода
- **SQLite** - база данных

## Установка и запуск

### 1. Клонирование репозитория

```bash
git clone <url репозитория>
cd higher-web-practice-quiz-python
```

### 2. Установка зависимостей (uv)

Проект использует `uv` для управления зависимостями и виртуальным окружением (создаётся `.venv/`).

```bash
# Установка uv (если не установлен)
pip install uv

# Установка зависимостей и создание .venv
uv sync
```

### 3. Применение миграций

```bash
uv run python manage.py migrate
```

### 4. Создание суперпользователя (опционально)

```bash
uv run python manage.py createsuperuser
```

### 5. Запуск сервера разработки

```bash
uv run python manage.py runserver
```

API будет доступен по адресу: `http://127.0.0.1:8000/api/`

## Документация API

Полная интерактивная документация доступна после запуска сервера:

- **Swagger UI**: `http://127.0.0.1:8000/swagger/`
- **ReDoc**: `http://127.0.0.1:8000/redoc/`

## Примеры запросов

### Категории

#### Получение списка категорий

**Запрос:**
```http
GET /api/category/
```

**Ответ:**
```json
[
    {
        "id": 1,
        "title": "История"
    },
    {
        "id": 2,
        "title": "География"
    }
]
```

#### Создание категории

**Запрос:**
```http
POST /api/category/
Content-Type: application/json

{
    "title": "Наука"
}
```

**Ответ:**
```json
{
    "id": 3,
    "title": "Наука"
}
```

**Статус:** `201 Created`

#### Получение категории по ID

**Запрос:**
```http
GET /api/category/1/
```

**Ответ:**
```json
{
    "id": 1,
    "title": "История"
}
```

#### Обновление категории

**Запрос:**
```http
PUT /api/category/1/
Content-Type: application/json

{
    "title": "Всемирная история"
}
```

**Ответ:**
```json
{
    "id": 1,
    "title": "Всемирная история"
}
```

#### Удаление категории

**Запрос:**
```http
DELETE /api/category/1/
```

**Ответ:**
```
HTTP 204 No Content
```

### Квизы

#### Получение списка квизов

**Запрос:**
```http
GET /api/quiz/
```

**Ответ:**
```json
[
    {
        "id": 1,
        "title": "Путешествия по Европе",
        "description": "Проверьте свои знания о европейских столицах и достопримечательностях"
    },
    {
        "id": 2,
        "title": "География мира",
        "description": ""
    }
]
```

#### Создание квиза

**Запрос:**
```http
POST /api/quiz/
Content-Type: application/json

{
    "title": "Математический квиз",
    "description": "Основы математики для начинающих"
}
```

**Ответ:**
```json
{
    "id": 3,
    "title": "Математический квиз",
    "description": "Основы математики для начинающих"
}
```

**Статус:** `201 Created`

#### Получение квиза по ID

**Запрос:**
```http
GET /api/quiz/1/
```

**Ответ:**
```json
{
    "id": 1,
    "title": "Путешествия по Европе",
    "description": "Проверьте свои знания о европейских столицах и достопримечательностях"
}
```

#### Поиск квизов по названию

**Запрос:**
```http
GET /api/quiz/by_title/Европе/
```

**Ответ:**
```json
[
    {
        "id": 1,
        "title": "Путешествия по Европе",
        "description": "Проверьте свои знания о европейских столицах и достопримечательностях"
    }
]
```

#### Получение случайного вопроса из квиза

**Запрос:**
```http
GET /api/quiz/1/random_question/
```

**Ответ:**
```json
{
    "id": 5,
    "quiz": 1,
    "category": 1,
    "text": "Какая река протекает через Париж?",
    "description": "",
    "options": ["Сена", "Темза", "Дунай", "Рейн"],
    "correct_answer": "Сена",
    "explanation": "Сена — главная водная артерия Парижа, разделяющая город на левый и правый берег",
    "difficulty": "easy"
}
```

#### Обновление квиза

**Запрос:**
```http
PUT /api/quiz/1/
Content-Type: application/json

{
    "title": "Путешествия по Европе: Расширенная версия",
    "description": "Углубленные знания о европейских городах"
}
```

**Ответ:**
```json
{
    "id": 1,
    "title": "Путешествия по Европе: Расширенная версия",
    "description": "Углубленные знания о европейских городах"
}
```

#### Удаление квиза

**Запрос:**
```http
DELETE /api/quiz/1/
```

**Ответ:**
```
HTTP 204 No Content
```

### Вопросы

#### Получение списка вопросов

**Запрос:**
```http
GET /api/question/
```

**Ответ:**
```json
[
    {
        "id": 1,
        "quiz": 1,
        "category": 1,
        "text": "Какая столица Италии?",
        "description": "Выберите правильный ответ",
        "options": ["Рим", "Милан", "Венеция", "Флоренция"],
        "correct_answer": "Рим",
        "explanation": "Рим — столица Италии и один из древнейших городов мира",
        "difficulty": "easy"
    }
]
```

#### Создание вопроса

**Запрос:**
```http
POST /api/question/
Content-Type: application/json

{
    "quiz": 1,
    "category": 1,
    "text": "В какой стране находится Эйфелева башня?",
    "description": "",
    "options": ["Франция", "Бельгия", "Швейцария", "Германия"],
    "correct_answer": "Франция",
    "explanation": "Эйфелева башня расположена в Париже, столице Франции",
    "difficulty": "easy"
}
```

**Ответ:**
```json
{
    "id": 2,
    "quiz": 1,
    "category": 1,
    "text": "В какой стране находится Эйфелева башня?",
    "description": "",
    "options": ["Франция", "Бельгия", "Швейцария", "Германия"],
    "correct_answer": "Франция",
    "explanation": "Эйфелева башня расположена в Париже, столице Франции",
    "difficulty": "easy"
}
```

**Статус:** `201 Created`

#### Получение вопроса по ID

**Запрос:**
```http
GET /api/question/1/
```

**Ответ:**
```json
{
    "id": 1,
    "quiz": 1,
    "category": 1,
    "text": "Какая столица Италии?",
    "description": "Выберите правильный ответ",
    "options": ["Рим", "Милан", "Венеция", "Флоренция"],
    "correct_answer": "Рим",
    "explanation": "Рим — столица Италии и один из древнейших городов мира",
    "difficulty": "easy"
}
```

#### Поиск вопросов по тексту

**Запрос:**
```http
GET /api/question/by_text/башня/
```

**Ответ:**
```json
[
    {
        "id": 2,
        "quiz": 1,
        "category": 1,
        "text": "В какой стране находится Эйфелева башня?",
        "description": "",
        "options": ["Франция", "Бельгия", "Швейцария", "Германия"],
        "correct_answer": "Франция",
        "explanation": "Эйфелева башня расположена в Париже, столице Франции",
        "difficulty": "easy"
    }
]
```

#### Проверка ответа на вопрос

**Запрос:**
```http
POST /api/question/1/check/
Content-Type: application/json

{
    "answer": "Рим"
}
```

**Ответ:**
```json
{
    "correct": true
}
```

#### Обновление вопроса

**Запрос:**
```http
PUT /api/question/1/
Content-Type: application/json

{
    "text": "Какая столица Италии?",
    "difficulty": "medium"
}
```

**Ответ:**
```json
{
    "id": 1,
    "quiz": 1,
    "category": 1,
    "text": "Какая столица Италии?",
    "description": "Выберите правильный ответ",
    "options": ["Рим", "Милан", "Венеция", "Флоренция"],
    "correct_answer": "Рим",
    "explanation": "Рим — столица Италии и один из древнейших городов мира",
    "difficulty": "medium"
}
```

#### Удаление вопроса

**Запрос:**
```http
DELETE /api/question/1/
```

**Ответ:**
```
HTTP 204 No Content
```

## Обработка ошибок

API возвращает понятные сообщения об ошибках:

### 404 Not Found

```json
{
    "detail": "Не найдено."
}
```

### 400 Bad Request (валидация)

```json
{
    "correct_answer": ["Правильный ответ должен быть одним из вариантов ответа."]
}
```

### 400 Bad Request (дубликат категории)

```json
{
    "title": ["Это поле должно быть уникальным."]
}
```

## Структура проекта

```
higher-web-practice-quiz-python/
├── core/                          # Общие модули
│   ├── __init__.py
│   └── constants.py               # Константы проекта
├── project/                       # Настройки проекта
│   ├── __init__.py
│   ├── settings.py                # Конфигурация Django
│   ├── urls.py                    # Главный роутинг
│   ├── asgi.py
│   └── wsgi.py
├── quiz/                          # Главное приложение
│   ├── migrations/                # Миграции БД
│   ├── services/                  # Слой доступа к данным (DAO)
│   │   ├── category.py            # Сервис для категорий
│   │   ├── quiz.py                # Сервис для квизов
│   │   └── question.py            # Сервис для вопросов
│   ├── views/                     # Контроллеры API
│   │   ├── category.py            # API категорий
│   │   ├── quiz.py                # API квизов
│   │   └── question.py            # API вопросов
│   ├── admin.py                   # Конфигурация админ-панели
│   ├── models.py                  # Модели данных
│   ├── serializers.py             # Сериализаторы DRF
│   ├── validators.py              # Валидаторы и нормализация данных
│   ├── urls.py                    # Маршруты API
│   └── dao.py                     # Абстрактные интерфейсы сервисов
├── tests/                         # Тесты
│   ├── test_services.py
│   └── test_views.py
├── db.sqlite3                     # База данных SQLite
├── manage.py                      # Django CLI
├── pyproject.toml                 # Зависимости проекта
├── pytest.ini                     # Конфигурация pytest
├── ruff.toml                      # Конфигурация линтера
└── README.md
```

## Проверка стиля кода

```bash
uv run ruff check .
```

## Запуск тестов

```bash
uv run pytest -q
```

## Административная панель

Django Admin доступен по адресу `http://127.0.0.1:8000/admin/`

### Возможности админ-панели:

#### Категории
- Список всех категорий с ID и названием
- Поиск по названию
- Сортировка по названию

#### Квизы
- Отображение ID, названия и описания
- Поиск по названию и описанию
- Фильтрация по названию
- Сортировка по названию

#### Вопросы
- Отображение ID, превью текста (50 символов), квиза, категории и сложности
- Поиск по тексту и описанию вопроса
- Фильтрация по сложности, квизу и категории
- Сортировка по квизу и ID
- Оптимизированные запросы с `select_related` для избежания N+1

## Автор

Дмитрий Канский, на основе шаблона от Яндекс.Практикума
